<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>香山黄山吉祥物 × AI路线推荐</title>
    <style>
        body{margin:0;overflow-x:hidden;background:linear-gradient(45deg,#4158D0,#C850C0,#FFCC70,#FBAB7E,#F7CE68);background-size:400%;animation:g 18s ease infinite;position:relative;font-family:Arial,sans-serif;}
        @keyframes g{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
        #particles{position:fixed;top:0;left:0;width:100%;height:100%;z-index:0;pointer-events:none;}
        .container{max-width:1200px;margin:20px auto;padding:20px;}
        .dolls{display:flex;gap:40px;justify-content:center;margin-bottom:50px;flex-wrap:wrap;}
        .doll-card{position:relative;width:100%;max-width:540px;background:rgba(255,255,255,0.96);border-radius:28px;overflow:hidden;box-shadow:0 25px 60px rgba(0,0,0,0.3);cursor:pointer;transition:transform 0.4s;}
        .doll-card:hover{transform:translateY(-12px);}
        .doll-card video{width:100%;display:block;}
        .doll-title{text-align:center;padding:16px;font-size:26px;color:#1e40af;font-weight:bold;background:rgba(255,255,255,0.9);}
        .sound-btn{position:absolute;bottom:16px;right:16px;width:56px;height:56px;border-radius:50%;border:none;font-size:32px;background:rgba(0,0,0,0.5);color:#ccc;box-shadow:0 4px 15px rgba(0,0,0,0.4);cursor:pointer;transition:all 0.3s;}
        .sound-btn.active{background:#10b981;color:white;transform:scale(1.15);box-shadow:0 6px 20px rgba(16,185,129,0.6);}
        .recommend{background:rgba(255,255,255,0.96);border-radius:28px;padding:40px;box-shadow:0 25px 60px rgba(0,0,0,0.25);backdrop-filter:blur(12px);}
        h1{text-align:center;color:#1e40af;font-size:3em;margin:0 0 10px;}
        .selector{text-align:center;margin:35px 0;}
        select,button{padding:16px 26px;font-size:19px;border-radius:14px;margin:10px;border:none;}
        select{background:white;box-shadow:0 5px 15px rgba(0,0,0,0.1);}
        button{background:#10b981;color:white;cursor:pointer;box-shadow:0 8px 25px rgba(16,185,129,0.4);}
        button:hover{transform:translateY(-3px);background:#059669;}
        #loading{text-align:center;color:#666;font-style:italic;margin:20px;display:none;}
        #result{margin-top:35px;padding:35px;background:rgba(255,255,255,0.97);border-radius:22px;text-align:center;box-shadow:0 15px 40px rgba(0,0,0,0.15);display:none;}
        .bigimg{width:100%;max-width:820px;border-radius:20px;margin:25px auto;box-shadow:0 15px 40px rgba(0,0,0,0.3);display:block;}
        .title{font-size:34px;color:#1e40af;margin:15px 0;}
        .map-btn{margin-top:20px;background:#007bff;color:white;padding:14px 28px;border:none;border-radius:12px;cursor:pointer;font-size:19px;}
        .map-btn:hover{background:#0056b3;}
        #mapModal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);z-index:1000;display:none;justify-content:center;align-items:center;}
        #mapContainer{width:95%;height:90%;background:white;border-radius:12px;overflow:hidden;position:relative;}
        #closeMap{position:absolute;top:20px;right:30px;background:none;border:none;font-size:40px;color:white;cursor:pointer;z-index:1001;}
        #mapStyleBtn{position:absolute;top:20px;left:20px;background:#fff;padding:8px 12px;border-radius:6px;border:none;cursor:pointer;font-size:14px;z-index:1001;}
        #weather-section{margin-top:20px;background:rgba(255,255,255,0.9);padding:20px;border-radius:12px;box-shadow:0 10px 20px rgba(0,0,0,0,0.2);text-align:left;}
        #current-time{font-size:18px;color:#1e40af;margin-bottom:10px;text-align:center;}
        #weather-current{font-size:24px;color:#007bff;margin-bottom:10px;}
        #weather-forecast{font-size:16px;color:#666;}
        #globalMusic{position:fixed;bottom:30px;right:30px;background:#ff6b6b;color:white;width:65px;height:65px;border-radius:50%;font-size:35px;border:none;box-shadow:0 10px 30px rgba(255,107,107,0.5);cursor:pointer;z-index:999;animation:p 2s infinite;}
        @keyframes p{0%{box-shadow:0 0 0 0 rgba(255,107,107,0.7)}70%{box-shadow:0 0 0 20px rgba(255,107,107,0)}100%{box-shadow:0 0 0 0 rgba(255,107,107,0)}}
        .bisu-badge{position:fixed;bottom:100px;right:30px;background:#1e40af;color:white;padding:10px 20px;border-radius:50px;font-size:16px;box-shadow:0 5px 15px rgba(0,0,0,0.3);z-index:998;cursor:pointer;}
    </style>
</head>
<body>

<canvas id="particles"></canvas>

<button id="globalMusic">Play Music</button>
<audio id="bgm" loop>
    <source src="林间的呼唤.mp3" type="audio/mpeg">
    <source src="踏山越水.mp3" type="audio/mpeg">
</audio>

<div class="bisu-badge" onclick="alert('BISU zyp - 你的专属旅游AI助手！')">BISU zyp</div>

<div class="container">
    <div class="dolls">
        <div class="doll-card" onclick="location.href='xiangshan-doll.html'">
            <video id="beijingVideo" autoplay loop playsinline muted preload="auto">
                <source src="xsw.mp4" type="video/mp4">
            </video>
            <div class="doll-title">北京娃娃 · 香山文创</div>
            <button class="sound-btn" onclick="event.stopPropagation(); toggleDollSound('beijingVideo', this)">Music Off</button>
        </div>
        <div class="doll-card" onclick="location.href='huangshan-doll.html'">
            <video id="huangshanVideo" autoplay loop playsinline muted preload="auto">
                <source src="hsw.mp4" type="video/mp4">
            </video>
            <div class="doll-title">黄山娃娃 · 黄山文创</div>
            <button class="sound-btn" onclick="event.stopPropagation(); toggleDollSound('huangshanVideo', this)">Music Off</button>
        </div>
    </div>

    <div class="recommend">
        <h1>AI智能旅游路线推荐</h1>
        <p style="text-align:center;font-size:24px;color:#1e40af;margin:10px;">根据你的心情，定制专属线路</p>

        <div class="selector">
            <select id="location">
                <option value="xiangshan">北京香山</option>
                <option value="huangshan">安徽黄山</option>
            </select>
            <select id="mood">
                <option value="quiet">安静治愈</option>
                <option value="energy">活力满满</option>
                <option value="old">怀旧感怀（仅香山）</option>
                <option value="photo">拍照出片</option>
                <option value="easy">轻松休闲</option>
                <option value="explore">探索好奇</option>
            </select>
            <button onclick="generate()">立即生成路线</button>
        </div>

        <div id="loading">AI正在智能分析您的心情并生成路线... 请稍候</div>
        <div id="result">
            <h2 class="title" id="title"></h2>
            <img id="routeImg" class="bigimg" src="" alt="线路实拍">
            <p style="font-size:20px;line-height:2;" id="detail"></p>
            <p style="color:#dc2626;font-weight:bold;font-size:19px;" id="weather"></p>

            <div id="weather-section">
                <h3>实时天气与时间</h3>
                <p id="current-time"></p>
                <p id="weather-current"></p>
                <div id="weather-forecast"></div>
            </div>

            <button id="showMap" class="map-btn" onclick="showMap()">查看路线地图</button>
        </div>
    </div>
</div>

<!-- 地图弹窗 -->
<div id="mapModal">
    <button id="closeMap" onclick="closeMap()">&times;</button>
    <button id="mapStyleBtn" onclick="toggleMapStyle()">切换卫星模式</button>
    <div id="mapContainer"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
<script src="https://webapi.amap.com/maps?v=2.0&key=a88b86b2a557c0ea14379177216583b3&plugin=AMap.Marker,AMap.Polyline,AMap.ToolBar,AMap.MapType"></script>

<script>
particlesJS("particles",{particles:{number:{value:80},color:{value:"#ffffff"},opacity:{value:0.5},size:{value:3},move:{enable:true,speed:1.5}},interactivity:{events:{onhover:{enable:true,mode:"bubble"},onclick:{enable:true,mode:"repulse"}}},retina_detect:true});

const musics = ["林间的呼唤.mp3", "踏山越水.mp3"];
document.getElementById("bgm").src = musics[Math.floor(Math.random()*2)];
document.getElementById("globalMusic").onclick = function(){
    const a = document.getElementById("bgm");
    a.paused ? a.play() : a.pause();
    this.innerHTML = a.paused ? "Play Music" : "Pause Music";
};

function toggleDollSound(id, btn){
    event.stopPropagation();
    const v = document.getElementById(id);
    v.muted = !v.muted;
    btn.innerHTML = v.muted ? "Music Off" : "Music On";
    btn.classList.toggle("active", !v.muted);
}

const imgMap = {
    xiangshan_quiet:"00467c0575766ced170557dd4f549b41.jpg",
    xiangshan_energy:"8729eae6e3e95a89789fb17fce841a35.jpg",
    xiangshan_old:"0d12629f15a1c49ac9306c933d612463.jpg",
    xiangshan_photo:"b2be80b2456a7a29e863aa5a2cf192ba.jpg",
    xiangshan_easy:"6735a83c7ddcd3a04a2dfbf33c7c7b47.jpg",
    xiangshan_explore:"9ccdf14169926b9b81eef53f49370ab2.jpg",
    huangshan_quiet:"38e99b51c01db79a2662512ff49def75.jpg",
    huangshan_energy:"5c361b57a2ea12f6ad2754b85bea085e.jpg",
    huangshan_photo:"104c5b489adf6e2bb70cc977b9497f48.jpg",
    huangshan_easy:"cff3dcad410403a034ff5e5e9dc07241.jpg",
    huangshan_explore:"4ff5bf42de115ae93840fdc6c8b2c051.jpg"
};

const data = {
    xiangshan: {
        quiet:   {t:"清幽古刹休闲线", d:"东门→静翠湖→见心斋→昭庙→碧云寺 从东门入园先赏静翠湖山水风光，再到江南园林风的见心斋看锦鲤戏水，随后逛汉藏风格的昭庙，最后去碧云寺看百年银杏与古建，全程人少景静，游览时长约3小时", w:"晴：建议穿轻便布鞋，午后逛碧云寺光线适合拍银杏与古建；阴：昭庙、碧云寺走廊多，可避雨，备好薄外套防凉；大风：避开昭庙高处平台"},
        energy:  {t:"全景登顶线", d:"东门→勤政殿→知松园→玉华岫→香炉峰→香山寺→双清别墅 从东门进先看勤政殿的元宝枫，再穿行知松园的古松林，到玉华岫赏漫山景致后登顶香炉峰，下山时途经香山寺和双清别墅，覆盖核心景点，全程约4小时", w:"晴：做好防晒，登顶前带足饮用水；雨：山路湿滑，香炉峰路段慎行；雾：登顶后视野差，可侧重山脚双清别墅、香山寺游览"},
        old:     {t:"红色文化怀旧线", d:"东门→勤政殿→双清别墅→来青轩→香山寺 从勤政殿出发，探访曾是中共中央驻地的双清别墅，再到朱德等同志曾居住的来青轩，最后逛盛唐始建的香山寺，感受历史底蕴，游览时长约2.5小时", w:"晴：适合在双清别墅庭院停留参观；小雨：室内场馆及走廊多，不影响行程，带便携雨伞即可"},
        photo:   {t:"高颜值打卡线", d:"东门→致远斋→知松园→香山寺（青霞寄逸楼）→香炉峰 先拍致远斋的古典庭院，再拍知松园苍劲古松，接着到香山寺青霞寄逸楼拍远山景致，最后登顶香炉峰拍全景，游览时长约3.5小时", w:"晴：上午10点左右光线柔和，拍古建无强逆光；多云：适合拍全景，无需担心强光刺眼"},
        easy:    {t:"平缓漫步线", d:"东门→南北主干道→香山历史文化展→知松园 沿主干道穿行山花观赏区，参观香山历史文化展，最后在知松园小憩，全程无爬坡，多平路，游览时长约1.5小时", w:"各类天气均适配，大风天气可在文化展室内停留，避免户外长时间逗留"},
        explore: {t:"小众探秘线", d:"东门→勤政殿→森玉笏→古御道→香山寺后院 从勤政殿左转走森玉笏看奇石景观，沿古御道感受旧时登山路，最后去香山寺后院探访少有人至的亭台，挖掘隐藏景致，游览时长约2小时", w:"雨：古御道路面易滑，建议改走旁边平缓辅路；晴：带遮阳帽，路段树荫较少"}
    },
    huangshan: {
        quiet:   {t:"迎客松轻闲线", d:"南大门→玉屏索道上行→蒲团松→海豚石→玉屏楼（打卡迎客松）→玉莲新道→远眺天都峰→玉屏索道下行 全程依赖索道，仅需短距离步行，主打近距离观赏迎客松等核心景观，人相对全景线更少，游览时长约3小时", w:"晴：在玉莲新道远眺天都峰视野佳；多云：山间易起轻雾，拍迎客松更有朦胧美；雨：索道正常运营，备好雨衣，步道有护栏需慢行"},
        energy:  {t:"全景环线", d:"南大门→云谷索道上行→始信峰→黑虎松→排云亭→西海大峡谷（观光缆车）→光明顶→鳌鱼峰→迎客松→玉屏索道下行 覆盖黄山奇松、怪石、云海等精华景观，索道+观光缆车辅助，行程充实且高效，全程约7-8小时", w:"晴：光明顶适合午后观云海，做好防晒；大风：西海大峡谷观光缆车可能停运，提前查看通知；雾：始信峰观景视野受限，可放缓脚步赏近景奇松"},
        photo:   {t:"地标打卡线", d:"南大门→云谷索道上行→梦笔生花→飞来石→光明顶→迎客松→玉屏索道下行 串联梦笔生花、飞来石等网红怪石景点，光明顶可拍全景，迎客松是标志性打卡点，游览时长约6小时", w:"晴：清晨在清凉台拍狮子峰远景光线佳；阴：飞来石周边无遮挡，注意防风；雨：减少在悬崖边停留，优先拍亭台与松石搭配的景致"},
        easy:    {t:"北海轻松线", d:"南大门→云谷索道上行→始信峰景观区→狮子峰（清凉台）→北海中路→云谷索道下行 聚焦北海核心区域，路线平缓，赏始信峰奇松、清凉台远景，无需长距离爬坡，游览时长约4小时", w:"各类天气适配，建议带少量零食补充体力，山上餐饮价格较高"},
        explore: {t:"小众探秘线", d:"北大门→太平索道上行→排云亭→西海大峡谷一环→西海大峡谷二环→网红小火车上行→天海景观区 深入西海大峡谷，看峡谷独特地貌，乘坐网红小火车体验特色交通，小众景奇，游览时长约5小时", w:"晴：峡谷内光线充足，适合拍地貌细节；雨：峡谷内可能有积水，听从工作人员指引；雪：冬季部分路段封闭，需提前确认开放情况"}
    }
};

let currentLoc = '';
let currentMood = '';
let map = null;
let mapStyle = 'normal'; // normal / satellite

// 路线坐标（高德GCJ-02）
const routeCoords = {
    xiangshan_quiet: [
        {name:"东门", lnglat:[116.1797,39.9910]},
        {name:"静翠湖", lnglat:[116.1845,39.9932]},
        {name:"见心斋", lnglat:[116.1840,39.9938]},
        {name:"昭庙", lnglat:[116.1830,39.9945]},
        {name:"碧云寺", lnglat:[116.1820,39.9955]}
    ],
    xiangshan_energy: [
        {name:"东门", lnglat:[116.1797,39.9910]},
        {name:"勤政殿", lnglat:[116.1805,39.9915]},
        {name:"知松园", lnglat:[116.1812,39.9923]},
        {name:"玉华岫", lnglat:[116.1820,39.9930]},
        {name:"香炉峰", lnglat:[116.1800,39.9950]},
        {name:"香山寺", lnglat:[116.1810,39.9940]},
        {name:"双清别墅", lnglat:[116.1810,39.9910]}
    ],
    xiangshan_old: [
        {name:"东门", lnglat:[116.1797,39.9910]},
        {name:"勤政殿", lnglat:[116.1805,39.9915]},
        {name:"双清别墅", lnglat:[116.1810,39.9910]},
        {name:"来青轩", lnglat:[116.1815,39.9915]},
        {name:"香山寺", lnglat:[116.1810,39.9940]}
    ],
    xiangshan_photo: [
        {name:"东门", lnglat:[116.1797,39.9910]},
        {name:"致远斋", lnglat:[116.1800,39.9920]},
        {name:"知松园", lnglat:[116.1812,39.9923]},
        {name:"香山寺", lnglat:[116.1810,39.9940]},
        {name:"香炉峰", lnglat:[116.1800,39.9950]}
    ],
    xiangshan_easy: [
        {name:"东门", lnglat:[116.1797,39.9910]},
        {name:"南北主干道", lnglat:[116.1810,39.9920]},
        {name:"香山历史文化展", lnglat:[116.1815,39.9925]},
        {name:"知松园", lnglat:[116.1812,39.9923]}
    ],
    xiangshan_explore: [
        {name:"东门", lnglat:[116.1797,39.9910]},
        {name:"勤政殿", lnglat:[116.1805,39.9915]},
        {name:"森玉笏", lnglat:[116.1818,39.9930]},
        {name:"古御道", lnglat:[116.1815,39.9940]},
        {name:"香山寺后院", lnglat:[116.1810,39.9945]}
    ],
    huangshan_quiet: [
        {name:"南大门", lnglat:[118.155,30.137]},
        {name:"玉屏索道", lnglat:[118.167,30.084]},
        {name:"蒲团松", lnglat:[118.166,30.082]},
        {name:"迎客松", lnglat:[118.166,30.082]}
    ],
    huangshan_energy: [
        {name:"南大门", lnglat:[118.155,30.137]},
        {name:"云谷索道", lnglat:[118.166,30.133]},
        {name:"始信峰", lnglat:[118.168,30.133]},
        {name:"西海大峡谷", lnglat:[118.173,30.126]},
        {name:"光明顶", lnglat:[118.166,30.128]},
        {name:"迎客松", lnglat:[118.166,30.082]}
    ],
    huangshan_photo: [
        {name:"南大门", lnglat:[118.155,30.137]},
        {name:"云谷索道", lnglat:[118.166,30.133]},
        {name:"梦笔生花", lnglat:[118.167,30.134]},
        {name:"飞来石", lnglat:[118.166,30.134]},
        {name:"光明顶", lnglat:[118.166,30.128]},
        {name:"迎客松", lnglat:[118.166,30.082]}
    ],
    huangshan_easy: [
        {name:"南大门", lnglat:[118.155,30.137]},
        {name:"云谷索道", lnglat:[118.166,30.133]},
        {name:"始信峰", lnglat:[118.168,30.133]},
        {name:"清凉台", lnglat:[118.168,30.135]},
        {name:"北海中路", lnglat:[118.167,30.134]}
    ],
    huangshan_explore: [
        {name:"北大门", lnglat:[118.168,30.138]},
        {name:"太平索道", lnglat:[118.168,30.138]},
        {name:"西海大峡谷", lnglat:[118.173,30.126]},
        {name:"天海", lnglat:[118.167,30.127]}
    ]
};

function generate(){
    currentLoc = document.getElementById("location").value;
    currentMood = document.getElementById("mood").value;
    const loading = document.getElementById("loading");
    const result = document.getElementById("result");
    loading.style.display = "block";
    result.style.display = "none";

    setTimeout(()=>{
        loading.style.display = "none";
        const key = currentLoc + "_" + currentMood;
        if(currentLoc==="huangshan" && currentMood==="old"){
            result.innerHTML = "<p style='color:#dc2626;font-size:22px;'>黄山暂无怀旧线路，换个心情试试哦～</p>";
            result.style.display = "block";
            return;
        }
        const r = data[currentLoc][currentMood];
        document.getElementById("title").innerHTML = r.t;
        document.getElementById("routeImg").src = imgMap[key] + "?v=" + Date.now();
        document.getElementById("detail").innerHTML = r.d;
        document.getElementById("weather").innerHTML = "天气提醒：" + r.w;
        document.getElementById("showMap").style.display = "block";
        result.style.display = "block";
        result.scrollIntoView({behavior:"smooth"});

        // 显示实时天气和时间
        updateWeatherAndTime(currentLoc);
    }, 1500);
}

// 实时天气 + 时间
function updateWeatherAndTime(loc){
    // 实时时间
    const now = new Date();
    document.getElementById("current-time").innerHTML = "当前时间：" + now.toLocaleString('zh-CN');

    // 实时天气（高德API）
    const adcode = loc === "xiangshan" ? "110105" : "341000"; // 香山区/黄山市
    fetch(`https://restapi.amap.com/v3/weather/weatherInfo?key=a88b86b2a557c0ea14379177216583b3&city=${adcode}&extensions=all`)
        .then(res => res.json())
        .then(data => {
            if(data.status === "1" && data.lives && data.lives.length > 0){
                const live = data.lives[0];
                document.getElementById("weather-current").innerHTML = 
                    `当前天气：${live.weather}　${live.temperature}°C　${live.humidity}%　${live.winddirection}风${live.windpower}级`;
            }
        })
        .catch(() => {
            document.getElementById("weather-current").innerHTML = "天气数据获取失败，使用本地模拟数据";
        });
}

// 显示地图
function showMap(){
    document.getElementById("mapModal").style.display = "flex";
    const key = currentLoc + "_" + currentMood;
    const coords = routeCoords[key] || [];

    map = new AMap.Map("mapContainer", {
        zoom: 14,
        center: coords[0]?.lnglat || [116.18, 39.99],
        mapStyle: mapStyle
    });

    coords.forEach((point, index) => {
        new AMap.Marker({
            map: map,
            position: point.lnglat,
            title: point.name,
            label: {content: (index+1) + ". " + point.name, offset: new AMap.Pixel(10, -10)}
        });
    });

    // 绘制路线
    if(coords.length > 1){
        new AMap.Polyline({
            map: map,
            path: coords.map(p => p.lnglat),
            strokeColor: "#3366FF",
            strokeWeight: 6,
            strokeOpacity: 0.8
        });
    }

    map.setFitView();
}

// 切换卫星/标准模式
function toggleMapStyle(){
    if(map){
        mapStyle = mapStyle === "normal" ? "amap://styles/satellite" : "amap://styles/normal";
        map.setMapStyle(mapStyle);
        document.getElementById("mapStyleBtn").innerHTML = mapStyle.includes("satellite") ? "标准模式" : "切换卫星模式";
    }
}

function closeMap(){
    document.getElementById("mapModal").style.display = "none";
    if(map) map.destroy();
    map = null;
}

// 页面加载完自动播放背景音乐
window.onload = () => document.getElementById("bgm").play().catch(()=>{});
</script>
</body>
</html>
